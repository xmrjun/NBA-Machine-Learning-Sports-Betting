<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NBA Edge Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% set fanduel_games = data.get('fanduel') or {} %}
    {% set games_count = fanduel_games|length %}
    <div class="page">
        <div class="backdrop">
            <div class="glow glow-1"></div>
            <div class="glow glow-2"></div>
            <div class="grid-overlay"></div>
        </div>

        <header class="site-header">
            <nav class="nav">
                <div class="brand">
                    <div class="brand-mark">NBA</div>
                    <div class="brand-text">
                        Edge Lab
                        <small>Machine Learning Picks</small>
                    </div>
                </div>
                <div class="nav-links">
                    <a href="#picks">Today's Board</a>
                    <a href="#stack">Model Stack</a>
                    <a href="#insights">Market Pulse</a>
                </div>
                <div class="nav-actions">
                    <a class="btn btn-ghost" href="#picks">View Picks</a>
                    <a class="btn btn-primary" href="#stack">How It Works</a>
                </div>
            </nav>
        </header>

        <main>
            <section class="hero">
                <div class="hero-copy reveal">
                    <div class="eyebrow">NBA Machine Learning</div>
                    <h1>Sharper NBA edges, distilled from every possession.</h1>
                    <p>
                        Model-driven win probabilities and totals picks, enriched with sportsbook odds,
                        expected value, and bankroll guidance. Updated daily for today's slate.
                    </p>
                    <div class="hero-actions">
                        <a class="btn btn-primary" href="#picks">Explore Today's Board</a>
                        <a class="btn btn-ghost" href="#insights">See Market Pulse</a>
                    </div>
                    <div class="hero-metrics">
                        <div class="metric-card">
                            <span>Today's slate</span>
                            <strong>{{ games_count }} matchups</strong>
                        </div>
                        <div class="metric-card">
                            <span>Sportsbooks</span>
                            <strong>FanDuel / DK / MGM</strong>
                        </div>
                        <div class="metric-card">
                            <span>Model focus</span>
                            <strong>Moneyline + Totals</strong>
                        </div>
                    </div>
                </div>
                <div class="hero-panel reveal" data-delay="120">
                    <div>
                        <div class="eyebrow">Slate snapshot</div>
                        <h3 class="panel-title">{{ today }} / Live model board</h3>
                        <p>Confidence-weighted projections with EV overlays and totals lean.</p>
                    </div>
                    <div class="pulse-grid">
                        <div class="pulse-item">
                            <span class="eyebrow">ML Accuracy</span>
                            <strong>~69%</strong>
                        </div>
                        <div class="pulse-item">
                            <span class="eyebrow">Totals Accuracy</span>
                            <strong>~55%</strong>
                        </div>
                        <div class="pulse-item">
                            <span class="eyebrow">Kelly Enabled</span>
                            <strong>Optional</strong>
                        </div>
                    </div>
                    <div class="chip">Updated {{ today }}</div>
                </div>
            </section>

            <section id="insights" class="section">
                <div class="section-header">
                    <div>
                        <div class="eyebrow">Market pulse</div>
                        <h2>Translate market odds into model-ready signals.</h2>
                        <p>We blend season-long team stats with live odds to surface value and totals lean.</p>
                    </div>
                    <div class="chip">Signal + Context</div>
                </div>
                <div class="insights-grid">
                    <div class="insight-card reveal">
                        <h4>EV Overlay</h4>
                        <p>Every side includes expected value so you can separate noise from true edge.</p>
                    </div>
                    <div class="insight-card reveal" data-delay="80">
                        <h4>Rest-Aware Features</h4>
                        <p>Days of rest and schedule effects are baked into matchup features.</p>
                    </div>
                    <div class="insight-card reveal" data-delay="160">
                        <h4>Odds Consistency</h4>
                        <p>Compare three books side-by-side and spot pricing gaps instantly.</p>
                    </div>
                    <div class="insight-card reveal" data-delay="240">
                        <h4>Totals Confidence</h4>
                        <p>Over/under picks include probability confidence to gauge conviction.</p>
                    </div>
                </div>
            </section>

            <section id="picks" class="section">
                <div class="section-header">
                    <div>
                        <div class="eyebrow">Today's Board</div>
                        <h2>Model picks for every matchup.</h2>
                        <p>Click any team name to see roster details and player form.</p>
                    </div>
                    <div class="chip">{{ today }}</div>
                </div>

                <div class="picks-grid">
                    {% for game_key, fd_game in fanduel_games.items() %}
                    {% set teams = game_key.split(':') %}
                    {% set away_team = teams[0] %}
                    {% set home_team = teams[1] %}
                    {% set lean_team = away_team %}
                    {% set lean_conf = 0 %}
                    {% if fd_game and fd_game.away_confidence %}
                        {% set lean_conf = fd_game.away_confidence|default('0')|float %}
                    {% endif %}
                    {% if fd_game and fd_game.home_confidence and (fd_game.home_confidence|float) > lean_conf %}
                        {% set lean_team = fd_game.home_team %}
                        {% set lean_conf = fd_game.home_confidence|float %}
                    {% endif %}
                    <article class="game-card reveal" data-delay="{{ loop.index0 * 60 }}">
                        <div class="game-header">
                            <div class="matchup">
                                <div class="team-stack">
                                    <span class="team-name" data-bs-toggle="modal" data-bs-target="#modal-{{ away_team|replace(' ', '-')|lower }}">{{ away_team }}</span>
                                    <span class="team-name" data-bs-toggle="modal" data-bs-target="#modal-{{ home_team|replace(' ', '-')|lower }}">{{ home_team }}</span>
                                </div>
                                <span class="at">@</span>
                            </div>
                            <div class="lean">
                                <span>Model lean</span>
                                <strong>{{ lean_team }}</strong>
                                <div class="player-meta">{{ lean_conf|round(1) }}% confidence</div>
                            </div>
                        </div>
                        <div class="books-grid">
                            {% for sportsbook in ['fanduel', 'draftkings', 'betmgm'] %}
                            {% set book_data = data.get(sportsbook) or {} %}
                            {% set sbgame = book_data.get(game_key) %}
                            <div class="book-card">
                                <div class="book-head">
                                    <span class="book-name">{{ sportsbook }}</span>
                                    {% if sbgame %}
                                        {% if sbgame.ou_pick %}
                                            <span class="ou-chip {% if sbgame.ou_pick == 'UNDER' %}under{% endif %}">{{ sbgame.ou_pick }} {{ sbgame.ou_value }}</span>
                                        {% endif %}
                                    {% endif %}
                                </div>
                                {% if sbgame %}
                                    {% set away_conf = sbgame.away_confidence|default('0')|float %}
                                    {% set home_conf = sbgame.home_confidence|default('0')|float %}
                                    {% set away_ev = sbgame.away_team_ev|default('0')|float %}
                                    {% set home_ev = sbgame.home_team_ev|default('0')|float %}
                                    <div class="book-lines">
                                        <div>
                                            <div class="line-row">
                                                <span>{{ sbgame.away_team }}</span>
                                                <span class="odds">
                                                    {% if sbgame.away_team_odds %}
                                                        {% if sbgame.away_team_odds|int > 0 %}+{% endif %}{{ sbgame.away_team_odds }}
                                                    {% else %}
                                                        --
                                                    {% endif %}
                                                </span>
                                                <span class="confidence">
                                                    {% if sbgame.away_confidence %}{{ sbgame.away_confidence }}%{% else %}--{% endif %}
                                                </span>
                                                <span class="ev {% if away_ev > 0 %}positive{% else %}negative{% endif %}">
                                                    {{ sbgame.away_team_ev if sbgame.away_team_ev else '--' }}
                                                </span>
                                            </div>
                                            <div class="confidence-bar" style="--bar: {{ away_conf }}%;">
                                                <span></span>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="line-row">
                                                <span>{{ sbgame.home_team }}</span>
                                                <span class="odds">
                                                    {% if sbgame.home_team_odds %}
                                                        {% if sbgame.home_team_odds|int > 0 %}+{% endif %}{{ sbgame.home_team_odds }}
                                                    {% else %}
                                                        --
                                                    {% endif %}
                                                </span>
                                                <span class="confidence">
                                                    {% if sbgame.home_confidence %}{{ sbgame.home_confidence }}%{% else %}--{% endif %}
                                                </span>
                                                <span class="ev {% if home_ev > 0 %}positive{% else %}negative{% endif %}">
                                                    {{ sbgame.home_team_ev if sbgame.home_team_ev else '--' }}
                                                </span>
                                            </div>
                                            <div class="confidence-bar" style="--bar: {{ home_conf }}%;">
                                                <span></span>
                                            </div>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="empty-book">No odds for this matchup.</div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </article>
                    {% endfor %}
                </div>
            </section>

            <section id="stack" class="section">
                <div class="section-header">
                    <div>
                        <div class="eyebrow">Model stack</div>
                        <h2>From raw stats to ready-to-bet predictions.</h2>
                        <p>A compact pipeline that goes from daily NBA data to live picks.</p>
                    </div>
                    <div class="chip">XGBoost + Neural Net</div>
                </div>
                <div class="feature-grid">
                    <div class="feature-card reveal">
                        <h3>Ingest</h3>
                        <p>Daily team stats and sportsbook odds flow into SQLite datasets.</p>
                    </div>
                    <div class="feature-card reveal" data-delay="90">
                        <h3>Feature build</h3>
                        <p>Matchups combine team baselines, days of rest, and totals data.</p>
                    </div>
                    <div class="feature-card reveal" data-delay="180">
                        <h3>Train</h3>
                        <p>XGBoost and neural nets learn win probabilities and totals leans.</p>
                    </div>
                    <div class="feature-card reveal" data-delay="270">
                        <h3>Deploy</h3>
                        <p>Live odds run through models to surface EV and Kelly sizing.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            Built for sharper NBA decisions. Data + models update daily.
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    {% include 'team_modal.html' %}
    {% include 'player_modal.html' %}
</body>
</html>
